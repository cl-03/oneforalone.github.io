
<!DOCTYPE html>

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Hacking in Lisp &#8212; Yuqi&#39;s Blog  文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Hacking in Golang" href="hacking-in-golang.html" />
    <link rel="prev" title="Hacking in Rust" href="hacking-in-rust.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=light-blue data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#programming/hacking-in-lisp" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Yuqi&#39;s Blog  文档"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">&#xe409</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Yuqi's Blog  文档</span>
          <span class="md-header-nav__topic"> Hacking in Lisp </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/oneforalone/oneforalone.github.io/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Yuqi's Blog
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Yuqi's Blog  文档</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">编程</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Yuqi&#39;s Blog 文档" class="md-nav__button md-logo">
      
        <i class="md-icon">&#xe409</i>
      
    </a>
    <a href="../index.html"
       title="Yuqi&#39;s Blog 文档">Yuqi's Blog  文档</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/oneforalone/oneforalone.github.io/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Yuqi's Blog
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../crypto/index.html" class="md-nav__link">Crypto</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../crypto/concepts.html" class="md-nav__link">Basic Concepts</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/overview-of-ethereum.html" class="md-nav__link">An Overview of Ethereum</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/substrate-tutorial.html" class="md-nav__link">Substrate Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/bitcoin-on-pi.html" class="md-nav__link">Raspberry Pi 安装 bitcoin</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/rust-web3-tutorial.html" class="md-nav__link">Rust Web3 Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/web3-development-toolkits.html" class="md-nav__link">Smart Contract Development Toolkits</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/GPG-on-Mac.html" class="md-nav__link">GPG Suit for Apple Mail on Mac OS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../crypto/dive-into-bitcoin.html" class="md-nav__link">Dive into Bitcoin</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../life/index.html" class="md-nav__link">随笔</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../life/after-work.html" class="md-nav__link">After Work</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../life/summary-of-2020.html" class="md-nav__link">Summary of 2020</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../life/rework.html" class="md-nav__link">Re-Work</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../life/my-fellows.html" class="md-nav__link">My Fellows</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../life/summary-of-2021.html" class="md-nav__link">Summary of 2021</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="index.html" class="md-nav__link">编程</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="hacking-in-c.html" class="md-nav__link">Hacking in C</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hacking-in-rust.html" class="md-nav__link">Hacking in Rust</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Hacking in Lisp </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Hacking in Lisp</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#programming-hacking-in-lisp--page-root" class="md-nav__link">Hacking in Lisp</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#basic" class="md-nav__link">Basic</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#environment-setups" class="md-nav__link">Environment Setups</a>
        </li>
        <li class="md-nav__item"><a href="#hello-lisp" class="md-nav__link">Hello Lisp</a>
        </li>
        <li class="md-nav__item"><a href="#defvar-defparameter-setf-setq" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code>/<code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#defvar-defparameter" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#setf-setq" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#features" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">*features*</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#iteration" class="md-nav__link">Iteration</a>
        </li>
        <li class="md-nav__item"><a href="#loop-hight-level-overview" class="md-nav__link">LOOP: Hight-level Overview</a>
        </li>
        <li class="md-nav__item"><a href="#functions" class="md-nav__link">Functions</a>
        </li>
        <li class="md-nav__item"><a href="#multiple-return-values" class="md-nav__link">Multiple return values</a>
        </li>
        <li class="md-nav__item"><a href="#higher-order-functions" class="md-nav__link">Higher order functions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#create-a-new-project" class="md-nav__link">Create a new project:</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#alist-plist" class="md-nav__link">Alist/Plist</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/programming/hacking-in-lisp.md.txt">显示源代码</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hacking-in-golang.html" class="md-nav__link">Hacking in Golang</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mathematic/index.html" class="md-nav__link">数学</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../mathematic/calculus-formula.html" class="md-nav__link">微积分之常用公式</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mathematic/brook-taylor.html" class="md-nav__link">泰勒公式</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mathematic/brook-taylor.html#id2" class="md-nav__link">泰勒级数</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../linux/index.html" class="md-nav__link">Linux</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../linux/linux-staffs-01.html" class="md-nav__link">我与 Linux 的那些事01：初识</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../linux/linux-staffs-02.html" class="md-nav__link">我与 Linux 的那些事02：选择</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../linux/linux-staffs-03.html" class="md-nav__link">我与 Linux 的那些事03：命令</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/index.html" class="md-nav__link">杂项</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../misc/vb-docker-conflicts.html" class="md-nav__link">Windows 上 VirtualBox 与 Docker 冲突问题</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/freebsd-install-x11.html" class="md-nav__link">FreeBSD 12 安装图形界面</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/dual-os-date-issue.html" class="md-nav__link">Windows/Debian 双系统时间问题</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/try-on-lispworks-personal.html" class="md-nav__link">初试 LispWorks</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/docker-k8s.html" class="md-nav__link">初探 Kubernetes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/frp.html" class="md-nav__link">内网穿透 frp 配置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/centos6-yum-repo.html" class="md-nav__link">CentOS 6 使用国内 yum 源</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/centos6-em2eth.html" class="md-nav__link">CentOS 6 网卡名 em 修改成 eth</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/vnc.html" class="md-nav__link">VNC 常见问题及解决方案</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/miscellaneous.html" class="md-nav__link">杂记</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/macos.html" class="md-nav__link">MacOS 使用记录</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/raspberry-pi-4b.html" class="md-nav__link">树莓派 4B</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../misc/git-with-gpg.html" class="md-nav__link">Using GPG signing key in git</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../projects/index.html" class="md-nav__link">项目</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="https://oneforalone.github.io/cl-cookbook-cn/#/" class="md-nav__link">The CommonLisp Cookbook</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="https://oneforalone.github.io/lol-zh/" class="md-nav__link">Let Over Lambda 中文翻译</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../about-me.html" class="md-nav__link">About Me</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#programming-hacking-in-lisp--page-root" class="md-nav__link">Hacking in Lisp</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#basic" class="md-nav__link">Basic</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#environment-setups" class="md-nav__link">Environment Setups</a>
        </li>
        <li class="md-nav__item"><a href="#hello-lisp" class="md-nav__link">Hello Lisp</a>
        </li>
        <li class="md-nav__item"><a href="#defvar-defparameter-setf-setq" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code>/<code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#defvar-defparameter" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#setf-setq" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#features" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">*features*</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#iteration" class="md-nav__link">Iteration</a>
        </li>
        <li class="md-nav__item"><a href="#loop-hight-level-overview" class="md-nav__link">LOOP: Hight-level Overview</a>
        </li>
        <li class="md-nav__item"><a href="#functions" class="md-nav__link">Functions</a>
        </li>
        <li class="md-nav__item"><a href="#multiple-return-values" class="md-nav__link">Multiple return values</a>
        </li>
        <li class="md-nav__item"><a href="#higher-order-functions" class="md-nav__link">Higher order functions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#create-a-new-project" class="md-nav__link">Create a new project:</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#alist-plist" class="md-nav__link">Alist/Plist</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/programming/hacking-in-lisp.md.txt">显示源代码</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="programming-hacking-in-lisp--page-root">Hacking in Lisp<a class="headerlink" href="#programming-hacking-in-lisp--page-root" title="永久链接至标题">¶</a></h1>
<p>Date: Mon Apr. 10 2022</p>
<p>对于 Lisp 来说，与其他语言的主要差别有三个：</p>
<ul class="simple">
<li><p><strong>Lisp 的每个表达式都会返回一个值，没有 statement 和 expression</strong>
<strong>的分别。</strong></p></li>
<li><p><strong>Lisp 的词法规则会比其他的语言简单些，词法树只需要解析小括号、引号、</strong>
<strong>空格以及逗号。引号包括双引号、单引号以及反引号。</strong></p></li>
<li><p><strong>Lisp 使用小括号作为统一的分隔符，而不是像其他语言一样使用多种组合</strong>
<strong>对 expression/statement 做分隔。所以 Lisp 把分号当作注释符。</strong></p></li>
</ul>
<p>上面三点是 Lisp 和其他语言的差异，也是为什么从其他语言转到 Lisp 会
比较疑惑的点。还有一点就是，其他语言是不会先对传过来的参数进行求值，
然后再将函数运用到这些参数的结果上，但是 Lisp 就是这么做的，<strong>先对参数</strong>
<strong>进行求值，然后再将函数应用到这些参数的结果上计算结果。</strong></p>

<h2 id="basic">Basic<a class="headerlink" href="#basic" title="永久链接至标题">¶</a></h2>
<p>如果是其他语言，没必要介绍编译环境的安装配置，因为基本都有官网，官网上也都有对
应的安装教程，或者说网上一搜一大堆。但 Lisp 或者说 Common Lisp（下面不对这
两者进行区分，统一使用 Lisp 指代 Common Lisp）不一样，最官方的是 LispWorks，
那个 IDE 贵的离谱，具体是 <span class="math notranslate nohighlight">\(1000 还是 \)</span>8000 我忘了，反正这超过普通的人承受
范围，虽然有免费版的，但是功能阉割的离谱，想要感受的自行去体验吧。</p>
<p>还有一点就是 Lisp 的编译器其实是比较多的，同时大部分时候又要搭配着 Emacs 使
用，Emacs 的配置需要投入一点时间去学习的。所以总给人一种比较混乱的感觉。而且
很多 Lisp 的教材里其实不会花什么篇幅去介绍环境配置。直接开讲，你自己要去验证
代码时就只能自己去查找资料。不过要感谢 Vindarel，他把这个门槛给砍掉了，让
Lisp 入门变得简单了。强烈推荐去看看他编写的 <a class="reference external" href="https://lispcookbook.github.io/cl-cookbook/">The Common Lisp Cookbook</a>，
当然我刚开始时也做了一下中文翻译，如果英文水平不是很好的话可以参考我翻译的
<a class="reference external" href="https://oneforalone.github.io/cl-cookbook-cn/#/">Common Lisp 秘籍</a>。</p>
<p>废话不多说，let's dive in.</p>

<h3 id="environment-setups">Environment Setups<a class="headerlink" href="#environment-setups" title="永久链接至标题">¶</a></h3>
<p>环境配置看你怎么选，如果你懒得去做一些配置什么的，有人已经写好了配置，直接下载
安装就好了，那个就是 <code class="docutils literal notranslate"><span class="pre">[Portacle][portacle]</span></code>。这个就是一个 IDE，里面基本的
配置都集成好了，开箱即用，版本什么的也比较新。</p>
<p>如果喜欢折腾的话，那么就需要自己安装 <a class="reference external" href="http://www.sbcl.org">sbcl</a>，至于你用什么编辑器编辑，
你自己选个喜欢的就好了，普遍用的都是 sbcl + slime + emacs。不过 vscode
和 vim 之类都也都是可以的。当然你也可以直接在 sbcl 中调试，但是要注意，
sbcl 不支持上下左右键，如果需要支持的话，需要安装 <code class="docutils literal notranslate"><span class="pre">[rlwrap][rlwrap]</span></code>，
然后启动时执行 <code class="docutils literal notranslate"><span class="pre">rlwrap</span> <span class="pre">sbcl</span></code>。</p>
<p>Lisp 的解释器或者说脚本语言的解释器都是遵循 REPL（Read Eval Print Loop）
的原则，只不过在 sbcl 中表达式执行错误的话会进入一个 interactive debugger，
要想退出这个 debugger，输入 0 或者按 Ctrl-D。或者更进一步想要去掉这个烦人的
debugger，可以在 sbcl 的配置文件 <code class="docutils literal notranslate"><span class="pre">~/.sbclrc</span></code> 中添加以下代码：</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">print-condition-hook</span> <span class="p">(</span><span class="kt">condition</span> <span class="nv">hook</span><span class="p">)</span>
  <span class="s">"Print this error message (condition) and abort the current operation."</span>
  <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">hook</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">princ</span> <span class="kt">condition</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">clear-input</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">abort</span><span class="p">))</span>

<span class="c1">;; WARN: this will</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*debugger-hook*</span> <span class="nf">#'</span><span class="nv">print-condition-hook</span><span class="p">)</span>
</pre></div>
</div>


<h3 id="hello-lisp">Hello Lisp<a class="headerlink" href="#hello-lisp" title="永久链接至标题">¶</a></h3>
<p>从 C 语言那里流传下来的传统（虽然 Lisp 要比 C 早），接触一门语言的
时候都喜欢用打印一个 "Hello World" 开始。其实大部分 Lisp 的教程
都不会一开始写 hello world，而是直接从其 <a class="reference external" href="https://baike.baidu.com/item/S-%E8%A1%A8%E8%BE%BE%E5%BC%8F/4409560">S-expression</a>
开始讲。但是这里我就遵循一下 C 的传统吧。</p>
<p>下面是 <code class="docutils literal notranslate"><span class="pre">hello.lisp</span></code> 的代码：</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">hello</span> <span class="p">()</span>
  <span class="s">"say hello"</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"hello lisp"</span><span class="p">))</span>

<span class="p">(</span><span class="nv">hello</span><span class="p">)</span>
</pre></div>
</div>
<p>然后直接使用 sbcl 的 <code class="docutils literal notranslate"><span class="pre">--script</span></code> 参数加载 <code class="docutils literal notranslate"><span class="pre">hello.lisp</span></code> 文件就好，会在
命令行中输出 <code class="docutils literal notranslate"><span class="pre">hello</span> <span class="pre">lisp</span></code> 这句话。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sbcl --script hello.lisp
hello lisp
</pre></div>
</div>
<p>如果源代码中调用了其他的库/包，需要再代码的最上面添加一行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">require</span> <span class="p">:</span><span class="n">asdf</span><span class="p">)</span>
</pre></div>
</div>
<p>如果想执行 <code class="docutils literal notranslate"><span class="pre">hello.lisp</span></code> 之后进入 sbcl，可以使用 <code class="docutils literal notranslate"><span class="pre">--load</span></code> 参数，这个参数
是先启动 sbcl，然后再执行 <code class="docutils literal notranslate"><span class="pre">hello.lisp</span></code> 。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sbcl --load hello.lisp
This is SBCL <span class="m">2</span>.1.9, an implementation of ANSI Common Lisp.
More information about SBCL is available at &lt;http://www.sbcl.org/&gt;.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly <span class="k">in</span> the public domain<span class="p">;</span> some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files <span class="k">in</span> the
distribution <span class="k">for</span> more information.
hello lisp
</pre></div>
</div>
<p>简单的讲一下 <code class="docutils literal notranslate"><span class="pre">hello.lisp</span></code>，<code class="docutils literal notranslate"><span class="pre">defun</span></code> 是函数定义宏，后面接函数名，然后是函数的参数，
再然后是使用双引号的文档注释，最后是函数的主体。格式就是 S-expression 的格式，开头
使用小括号，接一个函数或宏的名字，然后是其参数。至于 <code class="docutils literal notranslate"><span class="pre">format</span></code>，就是一个输出的函数，
可以类比其他语言的 <code class="docutils literal notranslate"><span class="pre">print</span></code> / <code class="docutils literal notranslate"><span class="pre">printf</span></code> 函数，不过这个字符串对应的转移符和类 C 的
不一致，其转移符使用的是 <code class="docutils literal notranslate"><span class="pre">~</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">\</span></code>，所以换行是 <code class="docutils literal notranslate"><span class="pre">~%</span></code>，和 <code class="docutils literal notranslate"><span class="pre">\n</span></code> 一样的效果。
更具体详细的介绍，参看 <a class="reference external" href="https://en.wikipedia.org/wiki/Format_(Common_Lisp)">wiki</a> 和 <a class="reference external" href="http://www.lispworks.com/documentation/lw50/CLHS/Body/22_c.htm">Lisp Hyper Spec: format</a>。</p>


<h3 id="defvar-defparameter-setf-setq"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code>/<code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code><a class="headerlink" href="#defvar-defparameter-setf-setq" title="永久链接至标题">¶</a></h3>
<p>refer to <a class="reference external" href="https://stackoverflow.com/questions/8927741/whats-difference-between-defvar-defparameter-setf-and-setq">what's difference between defvar defparameter setf and setq</a></p>

<h4 id="defvar-defparameter"><code class="docutils literal notranslate"><span class="pre">defvar</span></code>/<code class="docutils literal notranslate"><span class="pre">defparameter</span></code><a class="headerlink" href="#defvar-defparameter" title="永久链接至标题">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">defvar</span></code> 和 <code class="docutils literal notranslate"><span class="pre">defparameter</span></code> 这两个内置函数都是用来定义
全局变量的。区别在于 <code class="docutils literal notranslate"><span class="pre">defvar</span></code> 在第一次定义赋值后，之后都
不能修改这个变量的值，而 <code class="docutils literal notranslate"><span class="pre">defparameter</span></code> 是可以修改的。
<code class="docutils literal notranslate"><span class="pre">defvar</span></code> 相当于是定义了一个全局常量，而 <code class="docutils literal notranslate"><span class="pre">defparameter</span></code>
只是定义了一个全局变量而已。具体表现形式见如下代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defparameter</span> <span class="n">a</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">A</span>
<span class="o">&gt;</span> <span class="n">a</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">defparameter</span> <span class="n">a</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">A</span>
<span class="o">&gt;</span> <span class="n">a</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">defvar</span> <span class="n">b</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">B</span>
<span class="o">&gt;</span> <span class="n">b</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">defvar</span> <span class="n">b</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">B</span>
<span class="o">&gt;</span> <span class="n">b</span>
<span class="mi">1</span>
</pre></div>
</div>
<p>有一点需要注意的是，定义全局变量时，有一部分 lisper 喜欢使用 <code class="docutils literal notranslate"><span class="pre">*</span></code> 将变量
包起来，用来标识只是个全局变量，这个看自己的习惯吧，但是之后肯定会遇到这种
情况的。例如之后介绍的 <code class="docutils literal notranslate"><span class="pre">*features*</span></code>。</p>


<h4 id="setf-setq"><code class="docutils literal notranslate"><span class="pre">setf</span></code>/<code class="docutils literal notranslate"><span class="pre">setq</span></code><a class="headerlink" href="#setf-setq" title="永久链接至标题">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">setf</span></code> 和 <code class="docutils literal notranslate"><span class="pre">setq</span></code> 都是修改变量的值，区别是 <code class="docutils literal notranslate"><span class="pre">setf</span></code> 是使用了 <code class="docutils literal notranslate"><span class="pre">setq</span></code> 的宏，
对 <code class="docutils literal notranslate"><span class="pre">setq</span></code> 进行了拓展。因为 <code class="docutils literal notranslate"><span class="pre">setq</span></code> 不能对表达式的结果的值进行修改。具体的
差别参考下面的代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defparameter</span> <span class="n">c</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">C</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">car</span> <span class="n">c</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="mi">42</span>
<span class="o">&gt;</span> <span class="n">c</span>
<span class="p">(</span><span class="mi">42</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="n">setq</span> <span class="p">(</span><span class="n">car</span> <span class="n">c</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">;</span> <span class="ow">in</span><span class="p">:</span> <span class="n">SETQ</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span>
<span class="p">;</span>     <span class="p">(</span><span class="n">SETQ</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">caught</span> <span class="n">ERROR</span><span class="p">:</span>
<span class="p">;</span>   <span class="n">Variable</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">symbol</span><span class="p">:</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span><span class="o">.</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">compilation</span> <span class="n">unit</span> <span class="n">finished</span>
<span class="p">;</span>   <span class="n">caught</span> <span class="mi">1</span> <span class="n">ERROR</span> <span class="n">condition</span>

<span class="n">debugger</span> <span class="n">invoked</span> <span class="n">on</span> <span class="n">a</span> <span class="n">SB</span><span class="o">-</span><span class="n">INT</span><span class="p">:</span><span class="n">COMPILED</span><span class="o">-</span><span class="n">PROGRAM</span><span class="o">-</span><span class="n">ERROR</span> <span class="ow">in</span> <span class="n">thread</span>
<span class="c1">#&lt;THREAD "main thread" RUNNING {70085E3DB3}&gt;:</span>
  <span class="n">Execution</span> <span class="n">of</span> <span class="n">a</span> <span class="n">form</span> <span class="n">compiled</span> <span class="k">with</span> <span class="n">errors</span><span class="o">.</span>
<span class="n">Form</span><span class="p">:</span>
  <span class="p">(</span><span class="n">SETQ</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">Compile</span><span class="o">-</span><span class="n">time</span> <span class="n">error</span><span class="p">:</span>
  <span class="n">Variable</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">symbol</span><span class="p">:</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span><span class="o">.</span>

<span class="n">Type</span> <span class="n">HELP</span> <span class="k">for</span> <span class="n">debugger</span> <span class="n">help</span><span class="p">,</span> <span class="ow">or</span> <span class="p">(</span><span class="n">SB</span><span class="o">-</span><span class="n">EXT</span><span class="p">:</span><span class="n">EXIT</span><span class="p">)</span> <span class="n">to</span> <span class="n">exit</span> <span class="kn">from</span> <span class="nn">SBCL.</span>

<span class="n">restarts</span> <span class="p">(</span><span class="n">invokable</span> <span class="n">by</span> <span class="n">number</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">possibly</span><span class="o">-</span><span class="n">abbreviated</span> <span class="n">name</span><span class="p">):</span>
  <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="n">ABORT</span><span class="p">]</span> <span class="n">Exit</span> <span class="n">debugger</span><span class="p">,</span> <span class="n">returning</span> <span class="n">to</span> <span class="n">top</span> <span class="n">level</span><span class="o">.</span>

<span class="p">((</span><span class="n">LAMBDA</span> <span class="p">()))</span>
   <span class="n">source</span><span class="p">:</span> <span class="p">(</span><span class="n">SETQ</span> <span class="p">(</span><span class="n">CAR</span> <span class="n">C</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
<span class="mi">0</span><span class="p">]</span> <span class="n">abort</span>
</pre></div>
</div>


<h4 id="features"><code class="docutils literal notranslate"><span class="pre">*features*</span></code><a class="headerlink" href="#features" title="永久链接至标题">¶</a></h4>
<p>预定义的一个列表，可以自己添加一些自定义的特性，主要是用来根据不同的环境来执行
不同的代码。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#+unix</span>
<span class="p">(</span><span class="nb">print</span> <span class="s2">"We are on linux"</span><span class="p">)</span>
</pre></div>
</div>



<h3 id="iteration">Iteration<a class="headerlink" href="#iteration" title="永久链接至标题">¶</a></h3>
<p>Lisp 中控制循环迭代最原生的是 <code class="docutils literal notranslate"><span class="pre">loop</span></code>，其他的都是后面衍生出来的。
<code class="docutils literal notranslate"><span class="pre">dolist</span></code> 是遍历列表，<code class="docutils literal notranslate"><span class="pre">dotimes</span></code> 是已知循环的次数，<code class="docutils literal notranslate"><span class="pre">maphash</span></code>
是遍历 hash table 的。具体用法见下面代码。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loop</span></code>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'(1 3 5)</span>
     <span class="n">do</span> <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="n">NIL</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>

<span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'(1 3 5)</span>
     <span class="n">collect</span> <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>

<span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'(1 3 5)</span>
     <span class="nb">sum</span> <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="mi">9</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>

<span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'(1 3 5)</span>
     <span class="n">count</span> <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="mi">3</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>

<span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'(1 3 5)</span>
     <span class="n">maximize</span> <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="mi">5</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dolist</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">dolist</span> <span class="p">(</span><span class="n">x</span> <span class="s1">'(1 3 5))</span>
           <span class="n">x</span> <span class="p">;</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="k">return</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">last</span> <span class="nb">eval</span> <span class="n">of</span> <span class="n">x</span>
    <span class="p">(</span><span class="nb">print</span> <span class="n">x</span><span class="p">))</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">5</span>
<span class="n">NIL</span> <span class="p">;</span> <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">for</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">ql</span><span class="p">:</span><span class="n">quickload</span> <span class="s2">"for"</span><span class="p">)</span>

<span class="o">*</span> <span class="p">(</span><span class="k">for</span><span class="p">:</span><span class="k">for</span> <span class="p">((</span><span class="n">x</span> <span class="n">over</span> <span class="c1">#(0 2 4))</span>
            <span class="p">(</span><span class="n">y</span> <span class="n">over</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="n">t</span> <span class="s2">"~a - ~a ~%"</span> <span class="n">x</span> <span class="n">y</span><span class="p">))</span>
<span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span>
<span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span>
<span class="mi">4</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">NIL</span>
</pre></div>
</div>
<p>注，以上的循环中，<code class="docutils literal notranslate"><span class="pre">for</span></code> 的效率最低，所以慎用，个人还是比较喜欢用 <code class="docutils literal notranslate"><span class="pre">loop</span></code>。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maphash</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">ht</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">a</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">b</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">loop</span> <span class="p">:</span><span class="k">for</span> <span class="n">k</span> <span class="p">:</span><span class="n">being</span> <span class="p">:</span><span class="n">the</span> <span class="p">:</span><span class="nb">hash</span><span class="o">-</span><span class="n">key</span>
       <span class="p">:</span><span class="n">using</span> <span class="p">(:</span><span class="nb">hash</span><span class="o">-</span><span class="n">value</span> <span class="n">v</span><span class="p">)</span>
       <span class="p">:</span><span class="n">of</span> <span class="n">ht</span>
       <span class="n">do</span> <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nb">list</span> <span class="n">k</span> <span class="n">v</span><span class="p">))))</span>
<span class="p">(:</span><span class="n">A</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(:</span><span class="n">B</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">NIL</span>

<span class="o">*</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">ht</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">a</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">b</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">maphash</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">k</span> <span class="n">v</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nb">list</span> <span class="n">k</span> <span class="n">v</span><span class="p">)))</span>
             <span class="n">ht</span><span class="p">))</span>
<span class="p">(:</span><span class="n">A</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(:</span><span class="n">B</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">NIL</span>

<span class="o">*</span> <span class="p">(</span><span class="n">ql</span><span class="p">:</span><span class="n">quickload</span> <span class="s2">"alexandria"</span><span class="p">)</span>
<span class="o">*</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">ht</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">a</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">b</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">alexandria</span><span class="p">:</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="o">-</span><span class="n">keys</span> <span class="n">ht</span><span class="p">))</span>
<span class="p">(:</span><span class="n">B</span> <span class="p">:</span><span class="n">A</span><span class="p">)</span>

<span class="o">*</span> <span class="p">(</span><span class="n">ql</span><span class="p">:</span><span class="n">quickload</span> <span class="s2">"for"</span><span class="p">)</span>
<span class="o">*</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">ht</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">a</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="n">setf</span> <span class="p">(</span><span class="n">gethash</span> <span class="p">:</span><span class="n">b</span> <span class="n">ht</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">for</span><span class="p">:</span><span class="k">for</span> <span class="p">((</span><span class="n">key</span><span class="o">/</span><span class="n">value</span> <span class="n">over</span> <span class="n">ht</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">print</span> <span class="n">key</span><span class="o">/</span><span class="n">value</span><span class="p">)))</span>
<span class="p">;;</span> <span class="ow">or</span> <span class="n">using</span> <span class="n">trivial</span><span class="o">-</span><span class="n">do</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">yitzchak</span><span class="o">/</span><span class="n">trivial</span><span class="o">-</span><span class="n">do</span><span class="o">/</span>
<span class="p">(:</span><span class="n">A</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(:</span><span class="n">B</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">NIL</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dotimes</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">dotimes</span> <span class="p">(</span><span class="n">i</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">print</span> <span class="n">i</span><span class="p">))</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="n">NIL</span>

<span class="o">*</span> <span class="p">(</span><span class="n">loop</span> <span class="n">repeat</span> <span class="mi">3</span>
     <span class="n">do</span> <span class="p">(</span><span class="nb">print</span> <span class="s2">"hello"</span><span class="p">))</span>
<span class="s2">"hello"</span>
<span class="s2">"hello"</span>
<span class="s2">"hello"</span>
<span class="n">NIL</span>

<span class="p">;;</span> <span class="n">REPL</span><span class="p">:</span> <span class="n">READ</span> <span class="n">EVAL</span> <span class="n">PRINT</span> <span class="n">LOOP</span>
<span class="p">(</span><span class="n">loop</span> <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nb">eval</span> <span class="p">(</span><span class="n">read</span><span class="p">))))</span>
</pre></div>
</div>


<h3 id="loop-hight-level-overview">LOOP: Hight-level Overview<a class="headerlink" href="#loop-hight-level-overview" title="永久链接至标题">¶</a></h3>
<p>2 rules:</p>
<ul class="simple">
<li><p>respect the order</p></li>
<li><p>don't nest accumulating clauses</p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="c1">;; Iteration:</span>
<span class="c1">;; LOOP overview</span>
<span class="p">(</span><span class="nb">loop</span>
  <span class="c1">;; Initialize variables we loop over</span>
  <span class="ss">:for</span> <span class="nv">x</span> <span class="ss">:in</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span>
  <span class="ss">:for</span> <span class="nv">i</span> <span class="ss">:from</span> <span class="mi">1</span> <span class="ss">:to</span> <span class="mi">2</span> <span class="c1">;; ranges: to,below,downto...</span>
  <span class="ss">:for</span> <span class="nv">y</span> <span class="ss">:=</span> <span class="nv">i</span> <span class="ss">:then</span> <span class="mi">99</span>

  <span class="c1">;; Use intermediate variables</span>
  <span class="ss">:with</span> <span class="nv">z</span> <span class="ss">:=</span> <span class="s">"z"</span> <span class="c1">;; set once, not iterated.</span>

  <span class="c1">;; Initial clause</span>
  <span class="ss">:initially</span> <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"initially, i = ~S"</span> <span class="nv">i</span><span class="p">)</span>

  <span class="c1">;; Body</span>
  <span class="c1">;; Conditionals: if/else, when</span>
  <span class="c1">;; While, until, repeat</span>
  <span class="ss">:if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">i</span> <span class="mi">90</span><span class="p">)</span>
  <span class="ss">:do</span> <span class="p">(</span><span class="nb">return</span> <span class="nv">i</span><span class="p">)</span>  <span class="c1">;; early exit</span>

  <span class="c1">;; Main clauses: ;; do, collect... into,</span>
  <span class="c1">;; count, sum, maximize</span>
  <span class="c1">;; thereis, always, never</span>
  <span class="ss">:sum</span> <span class="nv">x</span> <span class="ss">:into</span> <span class="nv">res</span>

  <span class="c1">;; Final clause</span>
  <span class="ss">:finally</span> <span class="p">(</span><span class="nb">return</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">i</span> <span class="nv">res</span><span class="p">)))</span>
</pre></div>
</div>


<h3 id="functions">Functions<a class="headerlink" href="#functions" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">defun</span></code>：定义一个函数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apropos</span></code>：查看符号是否被定义</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">documentation</span></code>：查看对应的文档</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inspect</span></code>：查看具体的细节</p></li>
</ul>
<p>使用 <code class="docutils literal notranslate"><span class="pre">funcall</span></code> 调用函数时，可以使用 <code class="docutils literal notranslate"><span class="pre">#'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'</span></code>，两者的区别是：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#'</span></code>：表示调用当前词法作用域中定义的函数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'</span></code>：大部分时候是只 top-level 的函数，即全局作用域中的函数</p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">hello</span> <span class="p">(</span><span class="nv">name</span> <span class="k">&amp;key</span> <span class="p">(</span><span class="nv">happy</span> <span class="no">t</span> <span class="nv">happy-p</span><span class="p">))</span>
  <span class="s">"Say hello to NAME."</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"happy is: ~S~&amp;"</span> <span class="nv">happy</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"Hello ~a"</span> <span class="nv">name</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="nv">happy-p</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">happy</span>
        <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">" :)"</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">" :(((("</span><span class="p">))))</span>

<span class="p">(</span><span class="k">flet</span> <span class="p">((</span><span class="nv">hello</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">"*** hello ~a was overriden!~&amp;"</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"What is 'hello?~&amp;"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">describe</span> <span class="ss">'hello</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"What is #'hello? ~a"</span> <span class="nf">#'</span><span class="nv">hello</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">describe</span> <span class="nf">#'</span><span class="nv">hello</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">hello</span> <span class="s">"me"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">print</span> <span class="s">"Calling 'hello:"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="ss">'hello</span> <span class="s">"with quote"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">print</span> <span class="s">"Calling #'hello:"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="nf">#'</span><span class="nv">hello</span> <span class="s">"with #'"</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flet</span></code> ~ <code class="docutils literal notranslate"><span class="pre">let</span></code>，<code class="docutils literal notranslate"><span class="pre">let</span></code> 是对变量的绑定，<code class="docutils literal notranslate"><span class="pre">flet</span></code> 是对函数的绑定。
<code class="docutils literal notranslate"><span class="pre">labels</span></code> ~ <code class="docutils literal notranslate"><span class="pre">let*</span></code> 类似。</p>


<h3 id="multiple-return-values">Multiple return values<a class="headerlink" href="#multiple-return-values" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">values</span></code> 会输出多个值，但返回的是多个值中的第一个，可以使用 <code class="docutils literal notranslate"><span class="pre">nth-value</span></code>
获取到对应的元素，使用 <code class="docutils literal notranslate"><span class="pre">multiple-value-bind</span></code> 将 <code class="docutils literal notranslate"><span class="pre">values</span></code> 返回的多个值
绑定到多个变量上。</p>


<h3 id="higher-order-functions">Higher order functions<a class="headerlink" href="#higher-order-functions" title="永久链接至标题">¶</a></h3>
<p>Lisp 还有个优点是函数可以作为参数使用，这个后续的语言都是从 Lisp
模仿过去的。</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">compute</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="k">&amp;key</span> <span class="nv">operation</span> <span class="nf">#'</span><span class="nb">+</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="nv">operation</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="nv">compute</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">;; =&gt; 3</span>
<span class="p">(</span><span class="nv">compute</span> <span class="mi">1</span> <span class="mi">2</span> <span class="ss">:operation</span> <span class="nf">#'</span><span class="nb">-</span><span class="p">)</span> <span class="c1">;; =&gt; -1</span>

<span class="p">(</span><span class="nb">member</span> <span class="mi">2</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; =&gt; (2 3)</span>
<span class="p">(</span><span class="nb">member</span> <span class="s">"foo"</span> <span class="o">'</span><span class="p">(</span><span class="s">"rst"</span> <span class="s">"foo"</span><span class="p">)</span> <span class="ss">:test</span> <span class="nf">#'</span><span class="nb">string-equal</span><span class="p">)</span> <span class="c1">;; =&gt; ("foo")</span>
</pre></div>
</div>
<p>既然函数都能当参数使用，那么当作返回值也就没啥例外的了：</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">1+</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="nv">compute</span> <span class="mi">1</span> <span class="mi">2</span> <span class="ss">:operation</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">+</span> <span class="mi">10</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span> <span class="c1">;; =&gt; 13</span>
<span class="c1">;; or</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">add10</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">+</span> <span class="mi">10</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">compute</span> <span class="mi">1</span> <span class="mi">2</span> <span class="ss">:operation</span> <span class="nf">#'</span><span class="nv">add10</span><span class="p">)</span>

<span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="mi">10</span> <span class="mi">20</span> <span class="mi">30</span><span class="p">))</span> <span class="c1">;; =&gt; (11 22 33)</span>
</pre></div>
</div>
<p>同时还有个 <code class="docutils literal notranslate"><span class="pre">setf</span></code> 的属性</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">counter</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">counter-inc</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">incf</span> <span class="nv">counter</span><span class="p">))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">counter-init</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="nv">counter</span> <span class="mi">0</span><span class="p">))</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="nv">counter-value</span> <span class="p">()</span>
     <span class="nv">counter</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defun</span> <span class="p">(</span><span class="nb">setf</span> <span class="nv">counter-value</span><span class="p">)</span> <span class="p">(</span><span class="nv">new-value</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="nv">counter</span> <span class="nv">new-value</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">counter-inc</span><span class="p">)</span> <span class="c1">;; =&gt; 1</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">counter-value</span><span class="p">)</span> <span class="mi">9</span><span class="p">)</span> <span class="c1">;; =&gt; 9</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">defmethod</span></code>/<code class="docutils literal notranslate"><span class="pre">defgeneric</span></code> 用来定义泛型函数，区别在于
<code class="docutils literal notranslate"><span class="pre">defmethod</span></code> 是对每个具体实现的定义，而 <code class="docutils literal notranslate"><span class="pre">defgeneric</span></code>
可以使用 <code class="docutils literal notranslate"><span class="pre">:method</span></code> 关键词一次性定义多个实现。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">defmethod</span></code></p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="nb">*</span> <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">hello</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">print</span> <span class="nv">name</span><span class="p">))</span>

<span class="nb">*</span> <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">hello</span> <span class="p">((</span><span class="nv">obj</span> <span class="nc">hash-table</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"rrr we have a HT"</span><span class="p">))</span>

<span class="nb">*</span> <span class="p">(</span><span class="nv">hello</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
<span class="c1">;; =&gt; rrr we have a HT</span>
<span class="c1">;; NIL</span>
<span class="nb">*</span> <span class="p">(</span><span class="nv">hello</span> <span class="s">"me"</span><span class="p">)</span>
<span class="c1">;; "me"</span>
<span class="c1">;; "me"</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">defgeneric</span></code></p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defgeneric</span> <span class="nv">hello</span> <span class="p">(</span><span class="nv">sthg</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:method</span> <span class="p">((</span><span class="nv">sthg</span> <span class="no">t</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">print</span> <span class="nv">sthg</span><span class="p">))</span>
  <span class="p">(</span><span class="ss">:method</span> <span class="p">((</span><span class="nv">sthg</span> <span class="nc">hash-table</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"rrr we have a HT"</span><span class="p">))</span>
</pre></div>
</div>



<h2 id="create-a-new-project">Create a new project:<a class="headerlink" href="#create-a-new-project" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">my-project.asd</span></code>:</p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">in-package</span> <span class="ss">#:asdf-user</span><span class="p">)</span>

<span class="p">(</span><span class="nv">defsystem</span> <span class="ss">:my-project</span>
  <span class="ss">:depends-on</span> <span class="p">(</span><span class="ss">:alexandria</span> <span class="ss">:str</span> <span class="ss">:cl-ppcre</span> <span class="ss">:clingon</span><span class="p">)</span>
  <span class="c1">;; flat source tree:</span>
  <span class="c1">;; - .asd</span>
  <span class="c1">;; - .lisp</span>
  <span class="ss">:components</span> <span class="p">((</span><span class="ss">:file</span> <span class="s">"my-project"</span><span class="p">)</span> <span class="c1">;; .lisp file</span>
               <span class="p">(</span><span class="ss">:static-file</span> <span class="s">"README.md"</span><span class="p">)))</span>

<span class="cm">#|</span>
<span class="cm">With .lisp file in a src/ directory:</span>

<span class="cm">  :components ((:module "src"</span>
<span class="cm">                :components</span>
<span class="cm">                ((:file "utils")</span>
<span class="cm">                 (:file "my-project")</span>
<span class="cm">                 (:file "config")))</span>
<span class="cm">                (:module-2 ...))</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">my-project.lisp</span></code>:</p></li>
</ul>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defpackage</span> <span class="ss">#:mypackage</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="ss">:my-entry-point</span><span class="p">))</span>

<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:mypackage</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">my-entry-point</span> <span class="p">()</span>
  <span class="s">"Say hello to current user."</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"Hello ~a!"</span> <span class="p">(</span><span class="nv">uiop:getenv</span> <span class="s">"USER"</span><span class="p">)))</span>
</pre></div>
</div>
<p>在 package 的定义和使用中，<code class="docutils literal notranslate"><span class="pre">#:</span></code> 和 <code class="docutils literal notranslate"><span class="pre">:</span></code> 用法基本是一致，只是
有细微的差别，就是 <code class="docutils literal notranslate"><span class="pre">:</span></code> 会在当前的 image 中将后面的符号给占用，
符号补全时能找到，而 <code class="docutils literal notranslate"><span class="pre">#:</span></code> 不会占用符号，因此推荐使用 <code class="docutils literal notranslate"><span class="pre">#:</span></code>，
而不是 <code class="docutils literal notranslate"><span class="pre">:</span></code>。</p>
<p>systems: like Debian packages</p>
<p>packages: containers for symbols. Namespaces</p>

<h3 id="alist-plist">Alist/Plist<a class="headerlink" href="#alist-plist" title="永久链接至标题">¶</a></h3>
<p>这两种数据结构是轻量的 hash-table</p>
<ul class="simple">
<li><p>alist 的格式如下：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="p">(:</span><span class="n">a</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(:</span><span class="n">b</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>plist 的格式如下：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(:</span><span class="n">a</span> <span class="mi">1</span> <span class="p">:</span><span class="n">b</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>总的看来就是 alist 使用的是 <code class="docutils literal notranslate"><span class="pre">cons</span></code> 结构来关联 key-values，
内部是嵌套的，而 plist 是 flatten 的 alist，偶数索引的元素
为 key，索引为奇数的是 value（索引从 0 开始）。</p>
<p>详细的讲解参考下面这两篇文章：</p>
<ul class="simple">
<li><p>https://dnaeon.github.io/common-lisp-lookup-tables-alists-and-plists/</p></li>
<li><p>https://gigamonkeys.com/book/beyond-lists-other-uses-for-cons-cells.html</p></li>
</ul>





          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hacking-in-rust.html" title="Hacking in Rust"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hacking in Rust </span>
              </div>
            </a>
          
          
            <a href="hacking-in-golang.html" title="Hacking in Golang"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Hacking in Golang </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020-2022, Yuqi Liu.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>